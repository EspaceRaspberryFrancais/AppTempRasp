# AppTempRasp
Une fois l'application [*Température By Raspberry*](https://play.google.com/store/apps/details?id=fr.espace_raspberry_francais.espaceraspberry) installée, il suffit de suivre ce ReadMe pour lier l'application et le Raspberry Pi.

## Brancher la sonde au Raspberry Pi
La sonde se connecte au Raspberry en suivant le Schéma suivant :
![Schéma de branchement](http://espace-raspberry-francais.fr/Projets/Courbe-temp%C3%A9rature-accessible-avec-un-server-Web-Python/Images/Schema-Branchement-Raspberry-Model.3-DS18B20.png)

## Installer le git
Entrer les commandes suivantes pour télécharger le projet :
``` 
cd ~
git clone https://github.com/EspaceRaspberryFrancais/AppTempRasp.git
```

## Obtenir la référence de la sonde DS18B20 et actualiser le code
Pour que le code fonctionne, il faut modifier le fichier de *app.py* et renseigner le numéro de la sonde DS18B20. Pour obtenir ce numéro, entrer les commandes suivantes :
```
sudo modprobe w1-gpio
sudo modprobe w1-therm
ls /sys/bus/w1/devices/
```
Ceci renvoie quelque chose comme :
> **28-0317229e0bff**  w1_bus_master1

Si rien est afficher, réaliser [ces étapes.](http://espace-raspberry-francais.fr/Composants/Sonde-de-temperature-DS18B20-sur-Raspberry-Francais/#sondeNonDetecte)

La référence de la sonde est la partie en gras, il faut la recopier et le coller dans le fichier *app.py*, dans la variable ***referenceSonde***, ligne 13.
Pour modifier le fichier *app.py* :
``` 
sudo nano ~/AppTempRasp/app.py
```

## Automatiser la mesure de température
Pour faire fonctionner les statistiques et le graphique, il faut automatiser la prise de température, demander au Raspberry de la mesurer à intervalle régulier. Pour se faire, il faut modifier le fichier crontabs en entrant :
> sudo crontab -e

Le fichier doit ressembler à ceci :
```
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.L71rF1/crontab installed on Tue May 29 20:57:03 2018)
# (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $)
# Edit this file to introduce tasks to be run by cron.
#
# Each task to run has to be defined through a single line
# indicating with different fields when the task will be run
# and what command to run for the task
#
# To define the time you can provide concrete values for
# minute (m), hour (h), day of month (dom), month (mon),
# and day of week (dow) or use '*' in these fields (for 'any').#
# Notice that tasks will be started based on the cron's system
# daemon's notion of time and timezones.
#
# Output of the crontab jobs (including errors) is sent through
# email to the user the crontab file belongs to (unless redirected).
#
# For example, you can run a backup of all your user accounts
# at 5 a.m every week with:
# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
#
# For more information see the manual pages of crontab(5) and cron(8)
#
# m h  dom mon dow   command
```

Dans le fichier ouvert, ajouter à la dernière ligne ceci :
```
@reboot cd /home/pi/AppTempRasp; sudo python3 app.py
*/5 * * * * curl localhost:5000/getTemp?sauvegarde=True
```
## Et enfin...
Lancer le programme en  entrant la commande suivante :
```
sudo python3 ~/AppTempRasp/app.py
```
Il suffit ensuite de paramétrer l'application en ajoutant l'IP du Raspberry.
